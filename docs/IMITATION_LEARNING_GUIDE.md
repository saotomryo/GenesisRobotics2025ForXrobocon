# Imitation Learning Guide for Tri-star Robot

このドキュメントでは、Tri-starロボットの段差登坂能力を効率的に学習させるための「模倣学習（Imitation Learning）」の手順について説明します。

## 概要
段差登坂のような難易度の高いタスクでは、強化学習（RL）だけでゼロから学習させると、成功体験が得られず学習が進まない「報酬のスパース性」の問題が発生します。
そこで、人間が操作した「成功データ」を用いてモデルを事前学習（Behavior Cloning）し、ある程度登れるようになった状態から強化学習を開始することで、学習効率を劇的に向上させます。

## 手順

### 1. 成功動作の記録 (Manual Recording)
キーボード操作でロボットを動かし、段差を登る「お手本データ」を作成します。

**コマンド:**
```bash
python record_demonstration.py
```

**操作方法:**
*   `W` / `S`: 前進 / 後退 (ホイール)
*   `A` / `D`: 左旋回 / 右旋回 (ホイール)
*   `↑` / `↓`: フレーム回転 (前輪の持ち上げ/下げ)
*   `Space`: 全停止
*   `R`: **録画の開始 / 停止** (トグル式)
*   `ESC`: 終了

**記録のコツ:**
1.  段差の手前で一時停止し、`R`キーを押して録画を開始します。
2.  `↑`キーでフレームを回転させ、前輪を段差の高さまで持ち上げます。
3.  `W`キーで前進し、前輪を段差に乗せます。
4.  そのまま前進し続け、後輪も引き上げます。
5.  登りきったら少し進んで停止し、`R`キーを押して録画を停止します（自動的に保存されます）。
6.  これを **10回以上** 繰り返し、様々なバリエーションの成功データを作成します。

> **Note:** macOSで `Trace/BPT trap: 5` エラーが出る場合、キーボード入力ライブラリ(`pynput`)とシミュレータの競合が原因の可能性があります。その場合は、ターミナルへの入力受付に変更するなどのスクリプト修正が必要になることがあります。

### 2. 事前学習 (Behavior Cloning)
記録されたデータ (`demonstrations/*.npz`) を読み込み、PPOモデルを教師あり学習で事前トレーニングします。

**コマンド:**
```bash
python train_bc.py --epochs 50
```
*   `--epochs`: 学習回数（デフォルト50）。データ数が多い場合は減らしても構いません。
*   完了すると `xrobocon_ppo_tristar_large_bc.zip` が生成されます。

### 3. 強化学習の再開 (RL Fine-tuning)
事前学習済みモデルを初期値として、強化学習を再開します。

**コマンド:**
```bash
# モデル名を強化学習用の名前に変更（またはコピー）
cp xrobocon_ppo_tristar_large_bc.zip xrobocon_ppo_tristar_large_step.zip

# 強化学習を実行 (既存モデルがある場合はそこからロードされます)
python train_step_loop.py --robot tristar_large --steps 100000 --chunk 10000
```

これにより、ロボットは最初からある程度段差を登る方法を知っている状態で、試行錯誤を開始できます。
